<!DOCTYPE html>
<html>
    <meta charset="utf-8">
    <script src="https://aframe.io/releases/1.3.0/aframe.min.js"></script>
    <script type="text/javascript">
        AFRAME.registerComponent('proton', {
            schema: {
                name: {type: 'string', default: ""}, //назва частинки
                charge: {type: 'number', default: 0}, //заряд протона
                //радіус орбіти від центру колайдера
                dist: {type: 'number', default: 0},
                v: {type: 'array', default: [0,0,0]}, //вектор швидкості
                a: {type: 'array', default: [0,0,0]}, //вектор прискорення
                //координатний радіус-вектор
                pos: {type: 'array', default: [0,0,0]}},
            }
        });
        
        AFRAME.registerComponent('main', {
            init: function() {
                this.LHC = document.querySelectorAll('[proton]');
            },
            tick: function (time, deltaTime) {
                const day = 24.0*60*60;
                const dt = day/3; //крок інтегрування
                const K=8.85e-12; // стала
                for(var i = 0; i<this.LHC.length; i++) {
                    proton_i=this.LHC[i].getAttribute('proton');
                    proton_i.a[0]=proton_i.a[1]=proton_i.a[2]=0;
                    for(var j = 0; j<this.proton.length; j++) {
                        proton_j=this.LHC[j].getAttribute('proton');
                        if(i!=j) {
                            deltapos = [0,0,0];
                            for(var k = 0; k < 3; k++)
                                deltapos[k]=proton_j.pos[k]-proton_i.pos[k];
                            var r=Math.sqrt(Math.pow(deltapos[0],2) + Math.pow(deltapos[1],2) + Math.pow(deltapos[2],2));
                            for(var k = 0; k < 3; k++)
                                proton_i.a[k]+=K*proton_j.charge*deltapos[k]/
                            Math.pow(r, 3);
                        }
                    }
                    for(var k = 0; k < 3; k++)
                        proton_i.v[k]+=proton_i.a[k]*dt;
                    for(var k = 0; k < 3; k++)
                        proton_i.pos[k]+=proton_i.v[k]*dt;
                    this.LHC[i].setAttribute('position', (proton_i.pos[0]/1e9)+' '+(proton_i.pos[1]/1e9)+' '+(proton_i.pos[2]/1e9));
                }
            }
        });
    </script>
    
    <a-scene>
        <a-sky color="#4b0082"></a-sky>
        <a-torus position = "25 30 20" rotation="0 0 0" radius="3" material="color: yellow; opacity: 0.3; transparent: true"></a-torus>
     <a-entity geometry="primitive: sphere; radius: 0.1" position = "22 30 20" material="color: #0099ff" proton="dist: 3; charge: 1.6e-19; name: proton1; v: 3e8"></a-entity>
        <a-entity geometry="primitive: sphere; radius: 0.1" position = "28 30 20" material="color: #0099ff" proton="dist: 3; charge: 1.6e-19; name: proton2; v: 3e8"></a-entity>
        <a-entity geometry="primitive: sphere; radius: 0.4" position = "25 30 20" material="color:  #4b0082; opacity: 0; transparent: true"  proton="dist: 0; name: centre; v: 0"></a-entity>
        <a-camera position="25 30 28" cursor-visible="true" cursorscale="1" cursor-color="#0095DD" cursor-opacity="0.5"></a-camera>
    </a-scene>
</html>
